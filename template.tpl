___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "WelcomingWeb Accessibility Widget",
  "brand": {
    "id": "brand_dummy",
    "displayName": "WelcomingWeb.com",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Loads the WelcomingWeb accessibility widget with only your Widget ID. All styling/positioning is controlled by your server configuration.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "widgetId",
    "displayName": "Widget ID (UUID)",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
        ],
        "errorMessage": "Must be a valid UUID."
      }
    ],
    "valueHint": "e.g. d08333ec-2722-4a4e-91c1-049db9dc008b"
  },
  {
    "type": "TEXT",
    "name": "requiresConsent",
    "displayName": "Requires Consent (optional)",
    "simpleValueType": true,
    "help": "Comma-separated Consent Mode types to wait for (e.g. functional or functional,analytics). Leave empty for no consent gating.",
    "canBeEmptyString": true
  },
  {
    "type": "TEXT",
    "name": "cspNonce",
    "displayName": "CSP Nonce (optional)",
    "simpleValueType": true,
    "help": "If your site uses a CSP nonce and you want the widget’s Shadow DOM stylesheet cloning to carry that nonce, enter it here.",
    "canBeEmptyString": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

var log = require('logToConsole');
var injectHtml = require('injectHtml');

function toStr(v) {
  return (v === undefined || v === null) ? '' : (v + '');
}

function htmlEscape(s) {
  var str = toStr(s);
  str = str.split('&').join('&amp;');
  str = str.split('"').join('&quot;');
  str = str.split('<').join('&lt;');
  str = str.split('>').join('&gt;');
  return str;
}

function isNonEmpty(v) {
  if (v === undefined || v === null) { return false; }
  var str = v + '';
  // check for any non-whitespace char (space, tab, CR, LF)
  for (var i = 0; i < str.length; i++) {
    var code = str.charCodeAt(i);
    if (!(code === 32 || code === 9 || code === 10 || code === 13)) {
      return true;
    }
  }
  return false;
}

function addAttr(name, value) {
  return isNonEmpty(value) ? (' ' + name + '="' + htmlEscape(value) + '"') : '';
}

// Fixed CDN + path (no user override)
var CDN_HOST = 'https://cdn-01.welcomingweb.com';
var SCRIPT_PATH = '/a11y-widget.bundle.js';
var src = CDN_HOST + SCRIPT_PATH;

// Required
var widgetId = data.widgetId || '';
if (!isNonEmpty(widgetId)) {
  log('WelcomingWeb: Missing Widget ID');
  if (data.gtmOnFailure) { data.gtmOnFailure(); }
  return;
}

// Optional
var requiresConsent = data.requiresConsent || '';
var cspNonce = data.cspNonce || '';

// Security: only our known CDN
if (src.indexOf(CDN_HOST) !== 0) {
  log('WelcomingWeb: blocked non-allowed CDN source');
  if (data.gtmOnFailure) { data.gtmOnFailure(); }
  return;
}

// Build attributes (minimal set)
var attrs = '';
attrs += addAttr('data-widget-id', widgetId);
attrs += addAttr('data-requires-consent', requiresConsent);
attrs += addAttr('data-csp-nonce', cspNonce);

// Inject
var html = '<script src="' + htmlEscape(src) + '"' + attrs + '></script>';
injectHtml(html);

if (data.gtmOnSuccess) { data.gtmOnSuccess(); }


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

# WelcomingWeb Accessibility Widget – GTM Template (Light)

**What it does**  
Loads the WelcomingWeb Accessibility Widget via CDN with a single required field: **Widget ID**.

**How to use**
1. In GTM, add a new tag → **WelcomingWeb Accessibility Widget**.
2. Enter your **Widget ID** (UUID).
3. (Optional) Set **Requires Consent** (e.g. `functional` or `functional,analytics`) if you gate loading via CMP.
4. (Optional) Set **CSP Nonce** if your site uses a nonce and you want the injected script to carry it.
5. Trigger on **All Pages** (or as needed) → Publish.

**Consent (optional)**
- The tag will wait until consent is granted for the listed categories.
- You can grant via your CMP’s GTM consent integration, or call:
  ```js
  window.welcomingWeb.grantConsent();


